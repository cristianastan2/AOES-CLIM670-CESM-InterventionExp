















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-10-22 17:03:27 -0600">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - Intervention Experiments"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Intervention Experiments
  </title>  

  </head>
  <body>

    







    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-Intro/index.html">Intervention Experiments</a></li>
            
            
            <li><a href="../02-AddedHeating-Exps/index.html">Added Heating Experiments</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../about/index.html">About</a></li>
            
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>
















<h1 class="maintitle"><a href="../index.html">Intervention Experiments</a></h1>



<article>

<h1 id="intervention-experiments" class="maintitle">Intervention Experiments</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong>  min
      <br />
      <strong>Exercises:</strong>  min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What are Intervention Experiments?</p>
</li>
	
	<li><p>What questions can I answer with them?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="intevention-experiments">Intevention Experiments</h2>

<p>Experiments where you <code class="language-plaintext highlighter-rouge">intervene</code> in the model in some way to force a particular type of behavior and then see how the simulation evolves.</p>

<h3 id="challenges">Challenges</h3>
<ul>
  <li>Model does not respond well to big changes, so these have to be handled carefully</li>
  <li>Model behavior may be unphysical depending on the type of change imposed.</li>
</ul>

<h3 id="example-added-heating-experiments">Example: Added Heating Experiments</h3>

<p>These experiments nudge the model towards a specific atmospheric heating profile.</p>

<p>Explain how they (and nudging) works.</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="added-heating-experiments" class="maintitle">Added Heating Experiments</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong>  min
      <br />
      <strong>Exercises:</strong>  min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How to do the added heating experiments?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="added-heating">Added Heating</h2>

<p>The version of CESM that we are using (CESM 2.1.1) has code and a namelist configuration in the atmosphere that performs atmospheric nudging (also sometimes called relaxation) for zonal wind (U), meridional wind (V), temperature (T), specific humidity (Q), and pressure (PS).  We will setup an experiment to add a constant, idealized nudging to temperature (T).</p>

<p>Remember, source code is located in:</p>

<p><code class="language-plaintext highlighter-rouge">/glade/work/USERNAME/cesm2.1.1/components/</code></p>

<p>The source code for nudging in the atmosphere is located in the <code class="language-plaintext highlighter-rouge">cam</code> physics subroutines.</p>

<p>Let’s take a look:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /glade/work/USERNAME/cesm2.1.1/components/cam/src/physics/cam/
</code></pre></div></div>

<p>The subroutines are in the file <code class="language-plaintext highlighter-rouge">nudging.F90</code> and they are called by <code class="language-plaintext highlighter-rouge">physpkg.F90</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi nudging.F90
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

Nudging tendencies are applied as a relaxation force between the current
model state values and target state values derived from the avalilable
analyses. The form of the target values is selected by the 'Nudge_Force_Opt'
option, the timescale of the forcing is determined from the given
'Nudge_TimeScale_Opt', and the nudging strength Alpha=[0.,1.] for each
variable is specified by the 'Nudge_Xcoef' values. Where X={U,V,T,Q,PS}

F_nudge = Alpha*((Target-Model(t_curr))/TimeScale

...

</code></pre></div></div>

<p>What this means is that the nudging functions apply a contstraint that gently pushes the model towards a particular state of U,V,T,Q, or PS over some timescale.  Using the <code class="language-plaintext highlighter-rouge">cam</code> namelist, you can control how gentle or not gentle that push is and what it is pushed towards.</p>

<p>This nudging is preferrable to all the sudden imposing something in the model because it allows the model to adjust without responding in an unphysical way or <code class="language-plaintext highlighter-rouge">blowing up</code> and crashing due to an unrealistic instability. Models don’t like sudden big changes.</p>

<p>We will use this nudging functionality in the model to add a constant 3D heating to the T variable.  We will need to change the <code class="language-plaintext highlighter-rouge">nudging.F90</code> source code for this experiment.</p>

<h3 id="lets-create-and-setup-our-case">Let’s create and setup our case</h3>

<p>Remember to first go to your <code class="language-plaintext highlighter-rouge">/glade/work/USERNAME/cesm2.1.1/cime/scripts/</code> directory to run <code class="language-plaintext highlighter-rouge">create_newcase</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./create_newcase <span class="nt">--case</span> ~/cases/addheat <span class="nt">--res</span> f19_g17 <span class="nt">--compset</span> B1850 <span class="nt">--project</span> UGMU0032
<span class="nv">$ </span><span class="nb">cd</span> ~/cases/addheat
<span class="nv">$ </span>./case.setup
</code></pre></div></div>

<h3 id="step-1-modify-the-source-code">Step 1: Modify the Source Code</h3>

<p>Now we need to modify the nudging source code so that it will add a constant heating to T.</p>

<blockquote class="challenge">
  <h2 id="modifying-source-code">Modifying source code</h2>

  <p>Where do we put source code modifications for our case?</p>

  <p>a) user_nl_cam</p>

  <p>b) /glade/scratch/USERNAME/CASE/run</p>

  <p>c) $CASEROOT</p>

  <p>d) $CASEROOT/SourceMods/src.cam</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <p>a) not correct. this is where namelist changes go</p>

    <p>b) not correct. this is the run directory for your case.  we don’t make changes here.</p>

    <p>c) not correct.</p>

    <p>d) Correct! We will copy a new <code class="language-plaintext highlighter-rouge">nudging.F90</code> file to our <code class="language-plaintext highlighter-rouge">SourceMods/src.cam</code> directory to make changes.</p>

  </blockquote>
</blockquote>

<p>We are going to use a new <code class="language-plaintext highlighter-rouge">nudging.F90</code> file created by Dr. Swenson which has the code changes for applying an constant added heating to the atmospheric model.</p>

<p>Copy Dr. Swenson’s file: <code class="language-plaintext highlighter-rouge">/glade/u/home/swenson/run_CESM2.1.1/SourceMods/nudging.F90-ADDCONST</code> to our <code class="language-plaintext highlighter-rouge">SourceMods/src.cam</code> directory. Call the new file <code class="language-plaintext highlighter-rouge">nudging.F90</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> /glade/u/home/swenson/run_CESM2.1.1/SourceMods/nudging.F90-ADDCONST ./SourceMods/src.cam/nudging.F90
</code></pre></div></div>

<p>To see how this nudging.F90 code is different than the origingal, use <code class="language-plaintext highlighter-rouge">diff</code> command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>diff SourceMods/src.cam/nudging.F90 /glade/work/kpegion/cesm2.1.1/components/cam/src/physics/cam/nudging.F90 | more
</code></pre></div></div>

<p>Need to explain differences.</p>

<h2 id="step-2-modify-the-namelist">Step 2: Modify the namelist</h2>

<p>We need to modify our output and output frequency and some of the namelist parameters associated with the added heating configuration.  These are modified in the namelist <code class="language-plaintext highlighter-rouge">user_nl_cam</code>.</p>

<h4 id="modify-output-and-output-frequency">Modify output and output frequency:</h4>

<p><code class="language-plaintext highlighter-rouge">avgflag_pertape = ‘A’,‘I’,‘I’</code></p>

<p><code class="language-plaintext highlighter-rouge">nhtfrq = 0,-24,-6</code></p>

<p><code class="language-plaintext highlighter-rouge">mfilt = 1,1,1</code></p>

<p><code class="language-plaintext highlighter-rouge">fincl2 = ‘U’,‘V’,‘OMEGA’,‘Z3’,‘T’,‘Q’,‘PRECT’,‘FLUT’,‘TMQ’,‘PS’,‘PHIS’</code></p>

<p><code class="language-plaintext highlighter-rouge">fincl3 = ‘DTCOND’,‘QRS’,‘QRL’,‘DTV’,‘Nudge_T’,‘PS’,‘PHIS’</code></p>

<blockquote class="challenge">
  <h2 id="output-frequency">Output Frequency</h2>

  <p>What does <code class="language-plaintext highlighter-rouge">nhtfrq=0.-24,-6</code> mean?</p>

  <p>What does <code class="language-plaintext highlighter-rouge">mfilt=1,1,1</code> mean?</p>

  <p>What do <code class="language-plaintext highlighter-rouge">fincl2</code> and <code class="language-plaintext highlighter-rouge">fincl3</code> specify?</p>

  <p><code class="language-plaintext highlighter-rouge">avgflag_pertape = ‘A’,‘I’,‘I’</code> indicates how to average for each of the history files.</p>

  <p><code class="language-plaintext highlighter-rouge">A</code>=average value over the <code class="language-plaintext highlighter-rouge">nhtfrq</code></p>

  <p><code class="language-plaintext highlighter-rouge">I</code>=instantaneous value at the <code class="language-plaintext highlighter-rouge">nhtfrq</code></p>

</blockquote>

<h4 id="modify-the-nudging-namelist-configuration">Modify the <code class="language-plaintext highlighter-rouge">nudging</code> namelist configuration</h4>

<p><code class="language-plaintext highlighter-rouge">Nudge_Model = .true.</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Path = ‘/glade/scratch/swenson/archive/forcing/’</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_File_Template = ‘TEST1.cam.h3. %y-%m-%d-%s.nc’</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Times_Per_Day=4</code></p>

<p><code class="language-plaintext highlighter-rouge">Model_Times_Per_Day=48</code></p>

<p>Explain these.</p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Uprof = 0</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Ucoef = 0</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Vprof = 0</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Vcoef = 0</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Tprof = 2</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Tcoef = 1</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Qprof = 0</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Qcoef = 0</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_PSprof = 0</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_PScoef = 0</code></p>

<p>Explain these.</p>

<p>Now specify that we only want to apply this during the period from Feb 1, 1990 to Feb 28, 1990</p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Beg_Year = 1990</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Beg_Month = 2</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_Beg_Day  = 1</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_End_Year = 1990</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_End_Month = 2</code></p>

<p><code class="language-plaintext highlighter-rouge">Nudge_End_Day = 28</code></p>

<p>Explain</p>

<p>You can double check that you didn’t have any major mistakes in your <code class="language-plaintext highlighter-rouge">user_nl_cam</code> file by running <code class="language-plaintext highlighter-rouge">preview_namelists</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./preview_namelists
</code></pre></div></div>

<p>If you get an error, check for typos or for quotes if you cut and pasted. Remember sometimes quotes don’t cut and paste correctly!</p>

<h3 id="understanding-the-added-heating-forcing-file">Understanding the Added Heating Forcing File</h3>

<p>The forcing file we specified is: <code class="language-plaintext highlighter-rouge">/glade/scratch/swenson/archive/forcing/TEST1.cam.h3.%y-%m-%d-%s.nc</code>, where <code class="language-plaintext highlighter-rouge">%y-%m-%d-%s</code> refers to year, month, day, hour, seconds.</p>

<p>The model expects a netcdf file with U,V,T,Q, and PS on the model grid.</p>

<p>We are forcing <code class="language-plaintext highlighter-rouge">T</code>, so let’s look to see what the T forcing looks like for a specific date.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load ncview
ncview /glade/scratch/swenson/archive/forcing/TEST1.cam.h3.1990-02-01-21600.nc
</code></pre></div></div>

<p><img src="../fig/Picture1.png" alt="Forcing" /></p>

<p>Note: I looked at this in ncview and could not reproduce this.</p>

<h2 id="step-3-set-the-length-of-your-run">Step 3: Set the Length of your run</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xmlchange <span class="nv">STOP_N</span><span class="o">=</span>1
xmlchange <span class="nv">STOP_OPTION</span><span class="o">=</span>nmonths
</code></pre></div></div>

<h2 id="step-4--build-and-run-your-case">Step 4:  Build and Run your Case</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qcmd <span class="nt">--</span> ./case.build
./case.submit
</code></pre></div></div>

<h3 id="what-do-we-look-for-to-see-what-happened">What do we look for to see what happened?</h3>

<p>Can we point the students to some sample output and give them some direction on how to look at the impact of the added heating?</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li>
</li>
    
  </ul>
</blockquote>

<hr />


</article>

      
      






<footer>
  <div class="row">
    <div class="col-md-6 help-links" align="right">
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
